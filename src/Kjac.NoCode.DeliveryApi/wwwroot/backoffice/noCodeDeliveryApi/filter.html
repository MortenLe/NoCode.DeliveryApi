<div ng-controller="NoCodeDeliveryApi.FilterController as vm">

    <form novalidate name="filterForm" val-form-manager>

        <umb-editor-view>

            <umb-editor-header
                    name="model.title"
                    name-locked="true"
                    hide-alias="true"
                    hide-icon="true"
                    hide-description="true">
            </umb-editor-header>

            <umb-editor-container>

                <umb-box>

                    <umb-box-content>

                        <umb-control-group label="Name" description="Filter names must be unique. They are used to auto-generate the filter alias, which will be used for querying the Delivery API.">
                            <input type="text" name="filterName" ng-model="vm.filter.name" umb-auto-focus required maxlength="40" ng-change="vm.validateFilterName()" />
                        </umb-control-group>

                        <umb-control-group label="Property aliases" description="The aliases of the content properties whose values should be used for filtering. The filter will be evaluated against any of these properties.">
                            <div class="flex flex-auto">
                                <div>
                                    <input type="text" ng-pattern="vm.propertyAliasPattern" ng-model="vm.newPropertyAlias" ng-required="!vm.propertyAliases.length" />
                                </div>
                                <div style="margin-left: 12px;">
                                    <button type="button" class="btn btn-info" ng-click="vm.addPropertyAlias($event)" ng-disabled="!vm.newPropertyAlias">Add</button>
                                </div>
                            </div>
                            <div class="flex flex-inline items-center mb1" style="padding: 6px; background-color: #f3f3f5" ng-repeat="item in vm.propertyAliases">
                                <umb-icon icon="icon-autofill" class="icon muted" style="padding-right: 6px;" ></umb-icon>
                                <div>
                                    <input type="text" ng-pattern="vm.propertyAliasPattern" ng-model="item.propertyAlias" required style="margin: 0;" />
                                </div>
                                <div>
                                    <button type="button" class="umb-node-preview__action umb-node-preview__action--red" ng-click="vm.removePropertyAlias(item, $event)">Remove</button>
                                </div>
                            </div>
                        </umb-control-group>

                        <umb-control-group label="Field type" description="The field type determines how the the filter evaluates against the content properties. String fields allow for exact and partial matching, while Number and Date fields can be used for exact and range matching.">
                            <select class="umb-dropdown" ng-model="vm.filter.primitiveFieldType" required ng-disabled="vm.filter.key">
                                <option value="String">String</option>
                                <option value="Number">Number</option>
                                <option value="Date">Date</option>
                            </select>
                        </umb-control-group>

                        <umb-control-group label="Match type" description="Use exact matching for filtering against known identifiers (e.g. content pickers or product SKUs). Use partial matching for textual (wildcard) searches." ng-if="vm.filter.primitiveFieldType === 'String'">
                            <select class="umb-dropdown" ng-model="vm.filter.filterMatchType" required ng-disabled="vm.filter.key">
                                <option value="Exact" selected>Exact match</option>
                                <option value="Partial">Partial match</option>
                            </select>
                        </umb-control-group>

                    </umb-box-content>
                </umb-box>

            </umb-editor-container>

            <umb-editor-footer>
                <umb-editor-footer-content-right>
                    <umb-button
                            type="button"
                            button-style="link"
                            label-key="general_close"
                            shortcut="esc"
                            action="vm.close()">
                    </umb-button>
                    <umb-button
                            type="button"
                            button-style="success"
                            label-key="general_submit"
                            state="vm.saveButtonState"
                            action="vm.save()">
                    </umb-button>
                </umb-editor-footer-content-right>
            </umb-editor-footer>
        </umb-editor-view>

    </form>

</div>
